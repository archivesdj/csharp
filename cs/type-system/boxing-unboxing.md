# 박싱 vs. 언박싱

박싱(Boxing)과 언박싱(Unboxing)은 값 형식과 참조 형식 간의 변환 과정을 나타내는데, 이는 성능에 영향을 미칠 수 있는 중요한 개념입니다.

### 1. 박싱 (Boxing):

- **정의:** 박싱은 값 형식(구조체)을 참조 형식(클래스, 인터페이스 등)으로 변환하는 과정입니다.
  
- **과정:** 값 형식의 데이터가 힙 메모리에 새로운 객체로 복사되고, 해당 객체를 가리키는 참조(Reference)로 변환됩니다.
  
- **예시:**

    ```csharp
    int i = 42;
    object obj = i; // int가 object로 박싱
    ```

### 2. 언박싱 (Unboxing):

- **정의:** 언박싱은 참조 형식에서 값 형식으로 변환하는 과정입니다.
  
- **과정:** 힙에 저장된 객체를 스택에 있는 값 형식 변수로 복사하는 과정입니다.
  
- **예시:**

    ```csharp
    object obj = 42;
    int i = (int)obj; // object에서 int로 언박싱
    ```

### 주의사항:

1. **성능 문제:** 박싱과 언박싱은 성능에 영향을 미칠 수 있습니다. 불필요한 박싱과 언박싱은 메모리 오버헤드를 초래하고 성능을 저하시킬 수 있습니다.

2. **Null 체크:** 언박싱 시, 박싱된 객체가 null인 경우 `InvalidCastException`이 발생하므로 반드시 null 체크를 해야 합니다.

    ```csharp
    object obj = null;
    int? i = obj as int?; // i는 null
    ```

3. **박싱된 객체 재사용:** 같은 값 형식을 여러 번 박싱하면 각각 다른 객체가 생성되므로 성능 문제가 발생할 수 있습니다. 박싱된 객체를 재사용하는 것이 좋습니다.

    ```csharp
    object obj1 = 42;
    object obj2 = 42; // 새로운 객체 생성
    ```

### 성능 개선을 위한 팁:

- **`as` 연산자 사용:** `as` 연산자는 타입 변환이 실패하면 null을 반환하므로, 언박싱 전에 null 체크를 수행할 수 있습니다.

    ```csharp
    object obj = 42;
    int? i = obj as int?;
    ```

- **`Convert` 클래스 사용:** `Convert` 클래스의 메서드들은 값 형식과 참조 형식 간 변환 시 박싱과 언박싱을 최소화합니다.

    ```csharp
    object obj = 42;
    int i = Convert.ToInt32(obj);
    ```

박싱과 언박싱은 필요한 경우에만 사용하고, 불필요한 변환을 피해야 성능을 최적화할 수 있습니다. 특히, 컬렉션과 같은 곳에서 값 형식을 사용할 때 주의가 필요하며, 가능한한 제네릭 컬렉션을 활용하여 성능을 향상시키는 것이 좋습니다.